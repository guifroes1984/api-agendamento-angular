<div class="min-h-screen bg-gray-50">
  <nav class="bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-3">
          <i class="bi bi-shield-lock text-2xl"></i>
          <span class="font-bold text-xl">Moto Control</span>
        </div>
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2">
            <i class="bi bi-person-circle text-xl"></i>
            <span>{{ user?.usuario }}</span>
          </div>
          <button (click)="logout()"
            class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg transition flex items-center space-x-2">
            <i class="bi bi-box-arrow-right"></i>
            <span>Sair</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div *ngIf="loading$ | async" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
  </div>

  <div *ngIf="error$ | async as error" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-red-100 border-l-4 border-red-500 p-4">
      <p class="text-red-700">{{ error }}</p>
    </div>
  </div>

  <main *ngIf="!(loading$ | async)" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <header class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900">Olá, {{ user?.usuario }}!</h1>
      <p class="text-gray-500">Aqui está o resumo das suas atividades.</p>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-500">Ganhos Totais</h3>
        <p class="text-2xl font-semibold text-green-600">{{ (totalEarnings$ | async) | currency:'BRL' }}</p>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-500">Gastos Totais</h3>
        <p class="text-2xl font-semibold text-red-600">{{ (totalExpenses$ | async) | currency:'BRL' }}</p>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-sm font-medium text-gray-500">Lucro Líquido</h3>
        <p class="text-2xl font-semibold" [class.text-blue-600]="(netProfit$ | async) ?? 0 >= 0"
          [class.text-red-600]="(netProfit$ | async) ?? 0 < 0">
          {{ (netProfit$ | async) ?? 0 | currency:'BRL' }}
        </p>
      </div>
    </section>

    <section class="bg-white rounded-lg shadow p-4 mb-6">
      <h2 class="text-lg font-semibold mb-4 text-gray-900">Metas do Mês</h2>
      <div class="flex flex-col gap-4">
        <div>
          <div class="flex justify-between items-baseline mb-1">
            <span class="text-sm font-medium">Meta de Faturamento</span>
            <span class="text-xs text-gray-500">{{ (totalEarnings$ | async) | currency:'BRL' }} / {{ (monthlyGoal$ |
              async) | currency:'BRL' }}</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div class="bg-green-500 h-full rounded-full"
              [style.width.%]="((totalEarnings$ | async) ?? 0) / ((monthlyGoal$ | async) ?? 3000) * 100"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between items-baseline mb-1">
            <span class="text-sm font-medium">Meta de Lucro</span>
            <span class="text-xs text-gray-500">{{ (netProfit$ | async) | currency:'BRL' }} / {{ (profitGoal$ | async) |
              currency:'BRL' }}</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div class="bg-blue-500 h-full rounded-full"
              [style.width.%]="((netProfit$ | async) ?? 0) / ((profitGoal$ | async) ?? 1500) * 100"></div>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2 class="text-lg font-semibold mb-4 text-gray-900">Transações Recentes</h2>
      <div class="flex flex-col gap-3">
        <div *ngIf="(recentTransactions$ | async)?.length === 0" class="bg-white rounded-lg shadow text-center p-4">
          <p class="text-gray-500">Nenhuma transação encontrada.</p>
        </div>

        <div *ngFor="let transaction of recentTransactions$ | async; trackBy: trackById"
          class="flex items-center justify-between p-3 bg-white rounded-lg shadow">

          <div class="flex items-center flex-1 min-w-0">
            <div class="p-2 rounded-full flex-shrink-0" [class.bg-green-100]="transaction.tipo === 'GANHO'"
              [class.bg-red-100]="transaction.tipo === 'GASTO'">

              <svg *ngIf="transaction.tipo === 'GANHO'" class="w-6 h-6 text-green-600" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01">
                </path>
              </svg>

              <svg *ngIf="transaction.tipo === 'GASTO'" class="w-6 h-6 text-red-600" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
              </svg>
            </div>

            <div class="ml-4 min-w-0">
              <p class="font-semibold text-gray-900 truncate">{{ transaction.categoriaNome }}</p>
              <p class="text-sm text-gray-500">{{ transaction.data }}</p>
            </div>
          </div>

          <div class="flex items-center gap-2 md:gap-4 ml-2">
            <p class="font-semibold text-right w-24" [class.text-green-600]="transaction.tipo === 'GANHO'"
              [class.text-red-600]="transaction.tipo === 'GASTO'">
              {{ (transaction.tipo === 'GANHO' ? '+' : '-') + (transaction.valor | currency:'BRL') }}
            </p>

            <button (click)="openEditTransaction(transaction)"
              class="p-2 rounded-full text-gray-400 hover:bg-blue-100 hover:text-blue-600 transition-colors"
              title="Editar transação">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z">
                </path>
              </svg>
            </button>

            <button (click)="requestDeleteTransaction(transaction.id)"
              class="p-2 rounded-full text-gray-400 hover:bg-red-100 hover:text-red-600 transition-colors"
              title="Excluir transação">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                </path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<app-transaction-form *ngIf="showTransactionForm" [transaction]="editingTransaction" (save)="saveTransaction($event)"
  (cancel)="closeTransactionForm()">
</app-transaction-form>

<app-confirmation-modal *ngIf="showDeleteConfirm"
  message="Tem certeza que deseja excluir esta transação? Esta ação não pode ser desfeita." (confirm)="confirmDelete()"
  (cancel)="cancelDelete()">
</app-confirmation-modal>